<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>DTI Finance Wallet</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --primary:#00b894;
  --danger:#d63031;
  --edit:#0984e3;
  --dark:#2d3436;
  --bg:#f5f6fa;
  --card:#ffffff;
}
body{
  margin:0;
  font-family:'Segoe UI',system-ui,sans-serif;
  background:var(--bg);
}
header{
  background:linear-gradient(135deg,#0984e3,#00b894);
  color:#fff;
  padding:16px 24px;
  display:flex;
  justify-content:space-between;
}
header button{
  background:rgba(255,255,255,.2);
  border:1px solid rgba(255,255,255,.5);
  color:#fff;
  padding:6px 14px;
  border-radius:20px;
  cursor:pointer;
}
.container{
  max-width:1000px;
  margin:-40px auto 40px;
  padding:20px;
}
.wallet{
  background:linear-gradient(135deg,#6c5ce7,#0984e3);
  color:#fff;
  border-radius:20px;
  padding:24px;
}
.wallet h2{margin:6px 0 0;font-size:32px}
.stats{display:flex;gap:16px;margin-top:16px}
.stat{background:#fff;padding:14px;border-radius:12px;flex:1}
.history{background:#fff;border-radius:16px;padding:20px;margin-top:20px}
.tx{display:flex;justify-content:space-between;padding:10px 0;border-bottom:1px solid #eee}
.plus{color:var(--primary)}
.minus{color:var(--danger)}
.btn-delete{background:var(--danger);color:#fff;border:none;padding:4px 10px;border-radius:10px;cursor:pointer}
.btn-edit{background:var(--edit);color:#fff;border:none;padding:4px 10px;border-radius:10px;cursor:pointer;margin-right:6px}
#loginBox,#financeForm{display:none;background:#fff;padding:20px;border-radius:12px;margin-top:20px}
input,button{width:100%;padding:10px;margin-bottom:8px}
.btn-add{background:var(--primary);color:#fff;border:none}
</style>
</head>

<body>

<header>
  <h3>ðŸ’³ DTI Finance Wallet</h3>
  <div>
    <button id="loginBtn" onclick="showLogin()">Admin Login</button>
    <button id="logoutBtn" onclick="logout()" style="display:none">Logout</button>
  </div>
</header>

<div class="container">

  <div class="wallet">
    <span>Saldo</span>
    <h2 id="saldoHero">Rp 0</h2>
  </div>

  <div class="stats">
    <div class="stat">Pemasukan<br><b id="totalInput">0</b></div>
    <div class="stat">Pengeluaran<br><b id="totalOutput">0</b></div>
  </div>

  <div class="history">
    <h3>Riwayat Transaksi</h3>
    <div id="historyList"></div>
  </div>

  <!-- LOGIN -->
  <div id="loginBox">
    <h3>Login Admin</h3>
    <input id="username" placeholder="Username">
    <input id="password" type="password" placeholder="Password">
    <button class="btn-add" onclick="login()">Login</button>
    <p id="loginMsg" style="color:red"></p>
  </div>

  <!-- FORM -->
  <div id="financeForm">
    <h3 id="formTitle">Tambah Transaksi</h3>
    <input type="date" id="timelapse">
    <input type="number" id="input" placeholder="Input">
    <input type="number" id="output" placeholder="Output">
    <input type="text" id="description" placeholder="Deskripsi">
    <button class="btn-add" onclick="saveData()">Simpan</button>
  </div>

</div>

<script>
const API_URL='https://script.google.com/macros/s/AKfycbwVdahYSS-hmo0KIuxigPQ0QvlC794jLcEbtBITj5o2fkoT0c54Y5CfoAxOcVIil3dS/exec';
let IS_ADMIN=false;
let EDIT_ROW=null;

/* LOGIN */
function showLogin(){loginBox.style.display='block'}
function login(){
 fetch(API_URL+'?action=login',{
  method:'POST',
  body:JSON.stringify({username:username.value,password:password.value})
 }).then(r=>r.json()).then(res=>{
  if(res.status==='success'){
    IS_ADMIN=true;
    loginBox.style.display='none';
    financeForm.style.display='block';
    loginBtn.style.display='none';
    logoutBtn.style.display='inline-block';
    fetchData();
  } else loginMsg.textContent=res.message;
 });
}
function logout(){
 IS_ADMIN=false;
 financeForm.style.display='none';
 loginBtn.style.display='inline-block';
 logoutBtn.style.display='none';
 fetchData();
}

/* LOAD DATA */
function fetchData(){
 fetch(API_URL).then(r=>r.json()).then(res=>{
  let tin=0,tout=0;
  historyList.innerHTML='';
  res.data
  .filter(d=>Number(d.Input)>0||Number(d.Output)>0)
  .forEach(d=>{
    tin+=Number(d.Input);
    tout+=Number(d.Output);
    historyList.innerHTML+=`
      <div class="tx">
        <div>
          <b>${d.Description||'-'}</b><br>
          <small>${d.Timelapse.split('T')[0]}</small>
        </div>
        <div>
          <span class="${d.Input>0?'plus':'minus'}">
            ${d.Input>0?'+':'-'}${d.Input>0?d.Input:d.Output}
          </span>
          ${IS_ADMIN?`
            <button class="btn-edit" onclick="editData(${d.row},'${d.Timelapse}','${d.Input}','${d.Output}','${d.Description}')">Edit</button>
            <button class="btn-delete" onclick="deleteData(${d.row})">X</button>`:''}
        </div>
      </div>`;
  });
  totalInput.textContent=tin;
  totalOutput.textContent=tout;
  saldoHero.textContent='Rp '+(tin-tout);
 });
}

/* CREATE / UPDATE */
function saveData(){
 if(EDIT_ROW){
   fetch(API_URL,{
     method:'PUT',
     body:JSON.stringify({
       row:EDIT_ROW,
       Timelapse:timelapse.value,
       Input:Number(input.value),
       Output:Number(output.value),
       Description:description.value,
       role:'admin'
     })
   }).then(()=>{EDIT_ROW=null;fetchData();});
 }else{
   fetch(API_URL,{
     method:'POST',
     body:JSON.stringify({
       Timelapse:timelapse.value,
       Input:Number(input.value),
       Output:Number(output.value),
       Description:description.value,
       role:'admin'
     })
   }).then(fetchData);
 }
}

/* EDIT */
function editData(row,t,i,o,d){
 EDIT_ROW=row;
 timelapse.value=t.split('T')[0];
 input.value=i;
 output.value=o;
 description.value=d;
}

/* DELETE */
function deleteData(row){
 if(!confirm('Hapus transaksi?'))return;
 fetch(API_URL,{
   method:'DELETE',
   body:JSON.stringify({row,role:'admin'})
 }).then(fetchData);
}

fetchData();
</script>
</body>
</html>






