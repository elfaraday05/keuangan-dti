<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>DTI Finance Wallet</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root {
  --primary: #00b894;
  --danger: #d63031;
  --dark: #2d3436;
  --bg: #f5f6fa;
  --card: #ffffff;
}

* { box-sizing: border-box; }

body {
  margin: 0;
  font-family: 'Segoe UI', system-ui, sans-serif;
  background: var(--bg);
  color: var(--dark);
}

/* HEADER */
header {
  background: linear-gradient(135deg, #0984e3, #00b894);
  color: #fff;
  padding: 20px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

header h1 {
  margin: 0;
  font-size: 20px;
}

header button {
  background: rgba(255,255,255,0.2);
  border: 1px solid rgba(255,255,255,0.5);
  color: #fff;
  padding: 6px 12px;
  border-radius: 20px;
  cursor: pointer;
}

/* CONTAINER */
.container {
  max-width: 1100px;
  margin: -40px auto 40px;
  padding: 20px;
}

/* WALLET CARD */
.wallet {
  background: linear-gradient(135deg, #6c5ce7, #0984e3);
  color: #fff;
  border-radius: 20px;
  padding: 24px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.15);
}

.wallet h3 {
  margin: 0;
  font-size: 14px;
  opacity: 0.9;
}

.wallet .balance {
  font-size: 36px;
  font-weight: bold;
  margin-top: 8px;
}

/* STATS */
.stats {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px,1fr));
  gap: 16px;
  margin-top: 20px;
}

.stat {
  background: var(--card);
  border-radius: 16px;
  padding: 16px;
  box-shadow: 0 6px 16px rgba(0,0,0,0.08);
}

.stat span {
  font-size: 13px;
  color: #777;
}

.stat h2 {
  margin: 6px 0 0;
}

.income { color: var(--primary); }
.expense { color: var(--danger); }

/* CHART */
.chart-card {
  background: var(--card);
  border-radius: 16px;
  padding: 20px;
  margin-top: 24px;
  box-shadow: 0 6px 16px rgba(0,0,0,0.08);
}

/* HISTORY */
.history {
  background: var(--card);
  border-radius: 16px;
  padding: 20px;
  margin-top: 24px;
  box-shadow: 0 6px 16px rgba(0,0,0,0.08);
}

.history h3 {
  margin-top: 0;
}

.tx {
  display: flex;
  justify-content: space-between;
  padding: 12px 0;
  border-bottom: 1px solid #eee;
}

.tx:last-child { border-bottom: none; }

.tx .desc {
  font-size: 14px;
}

.tx .date {
  font-size: 12px;
  color: #777;
}

.tx .amount {
  font-weight: bold;
}

.plus { color: var(--primary); }
.minus { color: var(--danger); }

/* ADMIN */
#loginBox, #financeForm {
  display: none;
  background: var(--card);
  border-radius: 16px;
  padding: 20px;
  margin-top: 24px;
}

input, button {
  padding: 10px;
  border-radius: 8px;
  border: 1px solid #ddd;
  width: 100%;
  margin-bottom: 10px;
}

.btn-add {
  background: var(--primary);
  color: #fff;
  border: none;
  cursor: pointer;
}
</style>
</head>

<body>

<header>
  <h1>ðŸ’³ DTI Finance Wallet</h1>
  <div>
    <button id="loginBtn" onclick="showLogin()">Admin Login</button>
    <button id="logoutBtn" onclick="logout()" style="display:none">Logout</button>
  </div>
</header>

<div class="container">

  <!-- WALLET -->
  <div class="wallet">
    <h3>Saldo Saat Ini</h3>
    <div class="balance" id="saldoHero">Rp 0</div>
  </div>

  <!-- STATS -->
  <div class="stats">
    <div class="stat">
      <span>Pemasukan</span>
      <h2 class="income" id="totalInput">0</h2>
    </div>
    <div class="stat">
      <span>Pengeluaran</span>
      <h2 class="expense" id="totalOutput">0</h2>
    </div>
  </div>

  <!-- CHART -->
  <div class="chart-card">
    <canvas id="financeChart"></canvas>
  </div>

  <!-- HISTORY -->
  <div class="history">
    <h3>Riwayat Transaksi</h3>
    <div id="historyList"></div>
  </div>

  <!-- ADMIN LOGIN -->
  <div id="loginBox">
    <h3>Login Admin</h3>
    <input id="username" placeholder="Username">
    <input id="password" type="password" placeholder="Password">
    <button class="btn-add" onclick="login()">Login</button>
    <p id="loginMsg" style="color:red;text-align:center"></p>
  </div>

  <!-- ADMIN FORM -->
  <div id="financeForm">
    <h3>Tambah Transaksi</h3>
    <input type="date" id="timelapse" required>
    <input type="number" id="input" placeholder="Input" value="0">
    <input type="number" id="output" placeholder="Output" value="0">
    <input type="text" id="description" placeholder="Deskripsi">
    <button class="btn-add" onclick="addData(event)">Simpan</button>
  </div>

</div>

<script>
const API_URL = 'https://script.google.com/macros/s/AKfycbwVdahYSS-hmo0KIuxigPQ0QvlC794jLcEbtBITj5o2fkoT0c54Y5CfoAxOcVIil3dS/exec';
let IS_ADMIN = false;
let chart;

/* LOGIN */
function showLogin(){ loginBox.style.display='block'; }
function logout(){
  IS_ADMIN=false;
  loginBox.style.display='none';
  financeForm.style.display='none';
  loginBtn.style.display='inline-block';
  logoutBtn.style.display='none';
  fetchData();
}
function login(){
  fetch(API_URL+'?action=login',{
    method:'POST',
    body:JSON.stringify({username:username.value,password:password.value})
  }).then(r=>r.json()).then(res=>{
    if(res.status==='success'){
      IS_ADMIN=true;
      loginBox.style.display='none';
      financeForm.style.display='block';
      loginBtn.style.display='none';
      logoutBtn.style.display='inline-block';
      fetchData();
    } else loginMsg.textContent=res.message;
  });
}

/* DATA */
function fetchData(){
  fetch(API_URL).then(r=>r.json()).then(res=>{
    let tin=0,tout=0;
    let labels=[],inputs=[],outputs=[];
    historyList.innerHTML='';

    res.data.forEach(d=>{
      tin+=Number(d.Input);
      tout+=Number(d.Output);

      labels.push(d.Timelapse.split('T')[0]);
      inputs.push(d.Input);
      outputs.push(d.Output);

      historyList.innerHTML+=`
        <div class="tx">
          <div>
            <div class="desc">${d.Description||'-'}</div>
            <div class="date">${labels.at(-1)}</div>
          </div>
          <div class="amount ${d.Input>0?'plus':'minus'}">
            ${d.Input>0?'+':'-'}${d.Input>0?d.Input:d.Output}
          </div>
        </div>`;
    });

    totalInput.textContent=tin;
    totalOutput.textContent=tout;
    saldoHero.textContent='Rp '+(tin-tout);

    drawChart(labels,inputs,outputs);
  });
}

function drawChart(labels,inputs,outputs){
  if(chart) chart.destroy();
  chart=new Chart(document.getElementById('financeChart'),{
    type:'line',
    data:{
      labels,
      datasets:[
        {label:'Input',data:inputs,borderWidth:2},
        {label:'Output',data:outputs,borderWidth:2}
      ]
    }
  });
}

function addData(){
  fetch(API_URL,{
    method:'POST',
    body:JSON.stringify({
      Timelapse:timelapse.value,
      Input:input.value,
      Output:output.value,
      Description:description.value,
      role:'admin'
    })
  }).then(()=>{fetchData();});
}

fetchData();
</script>

</body>
</html>


